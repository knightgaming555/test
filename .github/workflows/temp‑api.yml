name: temp-api
on: workflow_dispatch         # run it on‑demand

jobs:
  api:
    runs-on: ubuntu-latest
    env:
      NGROK_TOKEN: ${{ secrets.NGROK_TOKEN }}   # add this secret in repo settings
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Create a tiny Flask app
        run: |
          pip install flask >/dev/null
          cat <<'PY' > api.py
          from flask import Flask, jsonify
          app = Flask(__name__)

          @app.route("/ping")
          def ping():
              return jsonify(ok=True)

          if __name__ == "__main__":
              app.run(host="0.0.0.0", port=8000)
          PY

      - name: Start API
        run: python api.py &

      - name: Expose port 8000 with ngrok
        uses: vmactions/ngrok-tunnel@v0.0.2     # any ngrok‑tunnel action works
        with:
          protocol: http
          port: 8000

      - name: Keep runner alive for an hour
        run: sleep 3600
